<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>privileges_functions: common_schema documentation</title>
	<meta name="description" content="privileges_functions: common_schema" />
	<meta name="keywords" content="privileges_functions: common_schema" />
	<link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
	<div id="main">
		<div id="header">
			<h1>common_schema documentation</h1>
			<div class="subtitle">Common views & routines for MySQL</div>
		</div>
		<div id="contentwrapper">
			<div id="content">
				<h2><a href="privileges_functions.html">privileges_functions</a></h2>	
<h3>PRIVILEGES FUNCTIONS</h3>

<p>
General functions: stored functions managing general tasks. All functions are DETERMINISTIC, NO SQL.
<ul>
	<li><a href="#match_grantee">match_grantee()</a>: Match an existing account based on user+host</li>
	<li><a href="#mysql_grantee">mysql_grantee()</a>: Return a qualified MySQL grantee (account) based on user and host.</li>
</ul>
</p>

<h3>SYNOPSIS</h3>

<p>
<ul>
	<li>
		<a name="match_grantee" href="#">match_grantee()</a>
		<p>
			Match an existing account based on user+host.
			MySQL does not provide with identification of logged in accounts. It only provides with 
			user + host:port combination within processlist. Alas, these do not directly map to accounts,
			as MySQL lists the host:port from which the connection is made, but not the (possibly wildcard)
			user or host.
		</p>
		<p>
		    This function matches a user+host combination against the known accounts, using the same
		    matching method as the MySQL server, to detect the account which MySQL identifies as the 
		    one matching. It is is essence similar to CURRENT_USER(), only it works for all sessions,
		    not just for the current session.
<blockquote><pre>match_grantee(connection_user char(16) CHARSET utf8, connection_host char(70) CHARSET utf8) 
  RETURNS VARCHAR(100) CHARSET utf8</pre></blockquote>
		</p>
		<p>
		  The <strong>host</strong> input field may optionally specify port number (e.g. <i>webhost:12345</i>),
		  which is discarded by the function. This is to support immediate input from 
		  <strong>INFORMATION_SCHEMA</strong>'s <strong>PROCESSLIST.HOST</strong> column.
		</p>
		<h4>EXAMPLES</h4>
<blockquote><pre>mysql&gt; SELECT match_grantee('apps', '192.128.0.1:12345') AS grantee;
+------------+
| grantee    |
+------------+
| 'apps'@'%' |
+------------+
</pre></blockquote>
	</li>
	<li>
		<a name="mysql_grantee" href="#">mysql_grantee()</a>
		<p>
			Return a qualified MySQL grantee (account) name based on <strong>user</strong> and <strong>host</strong>. 
			The output of this function is useful in automation of SQL query generation, or otherwise
			in comparing and recognizing accounts in different formats (user+host vs. grantee formats).
<blockquote><pre>mysql_grantee(mysql_user char(16) CHARSET utf8, mysql_host char(60) CHARSET utf8) 
  RETURNS VARCHAR(100) CHARSET utf8</pre></blockquote>
		</p>
			<h4>EXAMPLES</h4>
<blockquote><pre>SELECT common_schema.mysql_grantee('web_user', '192.128.0.%') AS grantee;
+--------------------------+
| grantee                  |
+--------------------------+
| 'web_user'@'192.128.0.%' |
+--------------------------+
</pre></blockquote>
	</li>
</ul>
</p>

<h3>ENVIRONMENT</h3>
MySQL 5.1 or newer

<h3>AUTHOR</h3>
Shlomi Noach
				<br/>
			</div>
			<div id="sidebarwrapper">
				<div id="menu">
					<ul>
						<li><a title="Introduction" href="introduction.html">Introduction</a></li>
						<li><a title="Download" href="download.html">Download</a></li>
						<li><a title="Install" href="install.html">Install</a></li>
						<li><a title="Risks" href="risks.html">Risks</a></li>
					</ul>						
					<h3>VIEWS</h3>
					<ul>
						<li><a title="auto_increment_columns" href="auto_increment_columns.html">auto_increment_columns</a></li>

						<li><a title="candidate_keys" href="candidate_keys.html">candidate_keys</a></li>

						<li><a title="data_size_per_engine" href="data_size_per_engine.html">data_size_per_engine</a></li>
						<li><a title="data_size_per_schema" href="data_size_per_schema.html">data_size_per_schema</a></li>


						<li><a title="global_status_diff" href="global_status_diff.html">global_status_diff</a></li>
						<li><a title="global_status_diff_clean" href="global_status_diff_clean.html">global_status_diff_clean</a></li>
						<li><a title="global_status_diff_nonzero" href="global_status_diff_nonzero.html">global_status_diff_nonzero</a></li>

						<li><a title="innodb_locked_transactions" href="innodb_locked_transactions.html">innodb_locked_transactions</a></li>

						<li><a title="innodb_index_rows" href="innodb_index_rows.html">innodb_index_rows</a></li>
						<li><a title="innodb_index_stats" href="innodb_index_stats.html">innodb_index_stats</a></li>

						<li><a title="innodb_simple_locks" href="innodb_simple_locks.html">innodb_simple_locks</a></li>
						<li><a title="innodb_transactions" href="innodb_transactions.html">innodb_transactions</a></li>
						<li><a title="innodb_transactions_summary" href="innodb_transactions_summary.html">innodb_transactions_summary</a></li>

						<li><a title="no_pk_innodb_tables" href="no_pk_innodb_tables.html">no_pk_innodb_tables</a></li>
						
						<li><a title="processlist_grantees" href="processlist_grantees.html">processlist_grantees</a></li>
						<li><a title="processlist_per_userhost" href="processlist_per_userhost.html">processlist_per_userhost</a></li>
						<li><a title="processlist_repl" href="processlist_repl.html">processlist_repl</a></li>
						<li><a title="processlist_summary" href="processlist_summary.html">processlist_summary</a></li>
						<li><a title="processlist_top" href="processlist_top.html">processlist_top</a></li>
						
						<li><a title="redundant_keys" href="redundant_keys.html">redundant_keys</a></li>
						<li><a title="routine_privileges" href="routine_privileges.html">routine_privileges</a></li>
						
						<li><a title="sql_alter_table" href="sql_alter_table.html">sql_alter_table</a></li>
						<li><a title="sql_foreign_keys" href="sql_foreign_keys.html">sql_foreign_keys</a></li>
						<li><a title="sql_grants" href="sql_grants.html">sql_grants</a></li>
						<li><a title="sql_show_grants" href="sql_show_grants.html">sql_show_grants</a></li>

						<li><a title="table_charset" href="table_charset.html">table_charset</a></li>
						<li><a title="text_columns" href="text_columns.html">text_columns</a></li>						
					</ul>						
					<h3>TABLES</h3>
					<ul>
						<li><a title="numbers" href="numbers.html">numbers</a></li>
					</ul>						
					<h3>FUNCTIONS</h3>
					<ul>
						<li><a title="General functions" href="general_functions.html">General functions</a></li>
						<li><a title="Privileges functions" href="privileges_functions.html">Privileges functions</a></li>
						<li><a title="String functions" href="string_functions.html">String functions</a></li>
						<li><a title="Time & date functions" href="time_functions.html">Time & date functions</a></li>
					</ul>
					<h3>PROCEDURES</h3>
					<ul>
						<li><a title="General procedures" href="general_procedures.html">General procedures</a></li>
					</ul>
				</div>
			</div>	
			<div class="clear">&nbsp;</div>
			
			<div id="footnote" align="center">
				<a href="">common_schema</a> documentation
			</div>
		</div>
	</div>
</body>
</html>
