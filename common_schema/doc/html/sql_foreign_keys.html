<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>sql_foreign_keys: common_schema documentation</title>
	<meta name="description" content="sql_foreign_keys: common_schema" />
	<meta name="keywords" content="sql_foreign_keys: common_schema" />
	<link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
	<div id="main">
		<div id="header">
			<h1>common_schema documentation</h1>
			<div class="subtitle">Common views & routines for MySQL</div>
		</div>
		<div id="contentwrapper">
			<div id="content">
				<h2><a href="sql_foreign_keys.html">sql_foreign_keys</a></h2>	
<h3>NAME</h3>
sql_foreign_keys: Generate create/drop foreign key constraints SQL statements
<h3>TYPE</h3>
View

<h3>DESCRIPTION</h3>
<p></p>

<p><i>sql_foreign_keys</i> provides with SQL statements to create/drop existing foreign key constraints.
</p>

<p>
Currently, foreign keys are not implemented at MySQL, but rather at the Storage Engine level. 
That is, MySQL does not manage foreign key constraints. Instead, each storage engine manages integrity within the engine, if at all.
</p>

<p>
InnoDB provides foreign key support. MyISAM/MEMORY/ARCHIVE/others do not. 3rd party engines may or may not implement foreign keys.
</p>

<p>
Unfortunately, not only does MySQL not manage the foreign keys, it also does not manage their existence, nor their definitions. 
Thus, should we ALTER and InnoDB table with foreign keys to MyISAM, all foreign key information is lost: the definition itself ceases to exist.
When ALTERing the table back to InnoDB the foreign key remains lost.
</p>

<p>
It is useful to be able to generate the SQL required to "resurrect" foreign key definitions, and <i>sql_foreign_keys</i> does just that. 
It builds upon the INFORMATION_SCHEMA views which provides the foreign key metadata to generate 
<strong>'ALTER TABLE ... ADD CONSTRAINT ... FOREIGN KEY ...'</strong> / <strong>'ALTER TABLE ... DROP FOREIGN KEY'</strong> statement pairs. 
</p>

<h3>STRUCTURE</h3>

<blockquote><pre>
mysql&gt; DESC common_schema.sql_foreign_keys;
+------------------+--------------+------+-----+---------+-------+
| Field            | Type         | Null | Key | Default | Extra |
+------------------+--------------+------+-----+---------+-------+
| TABLE_SCHEMA     | varchar(64)  | NO   |     |         |       |
| TABLE_NAME       | varchar(64)  | NO   |     |         |       |
| CONSTRAINT_NAME  | varchar(64)  | NO   |     |         |       |
| drop_statement   | varchar(229) | YES  |     | NULL    |       |
| create_statement | longtext     | YES  |     | NULL    |       |
+------------------+--------------+------+-----+---------+-------+
</pre></blockquote>

<h3>SYNOPSIS</h3>

<p>Columns of this view:</p>
<ul>
	<li><strong>TABLE_SCHEMA</strong>: schema of constraint's table</li>
	<li><strong>TABLE_NAME</strong>: table on which constraint is defined (this is child/dependent side of relation)</li>
	<li><strong>CONSTRAINT_NAME</strong>: name of foreign key constraint (unique within its schema)</li>
	<li><strong>drop_statement</strong>: A SQL statement which drops the constraint from this table (via ALTER TABLE)</li>
	<li><strong>create_statement</strong>: A SQL statement which creates this constraint (via ALTER TABLE)</li>
</ul>

<p>The SQL statements are not terminated by ';'.</p>

<h3>EXAMPLES</h3>
<p>Show foreign keys create/drop statements for `sakila`.`film_actor` (depends on `film` and `actor` tables)</p>
<blockquote><pre>mysql&gt; SELECT * FROM common_schema.sql_foreign_keys WHERE TABLE_SCHEMA='sakila' AND table_name='film_actor' \G
*************************** 1. row ***************************
    TABLE_SCHEMA: sakila
      TABLE_NAME: film_actor
 CONSTRAINT_NAME: fk_film_actor_actor
  drop_statement: ALTER TABLE `sakila`.`film_actor` DROP FOREIGN KEY `fk_film_actor_actor`
create_statement: ALTER TABLE `sakila`.`film_actor` ADD CONSTRAINT `fk_film_actor_actor` FOREIGN KEY (`actor_id`) REFERENCES `sakila`.`actor` (`actor_id`) ON DELETE RESTRICT ON UPDATE CASCADE
*************************** 2. row ***************************
    TABLE_SCHEMA: sakila
      TABLE_NAME: film_actor
 CONSTRAINT_NAME: fk_film_actor_film
  drop_statement: ALTER TABLE `sakila`.`film_actor` DROP FOREIGN KEY `fk_film_actor_film`
create_statement: ALTER TABLE `sakila`.`film_actor` ADD CONSTRAINT `fk_film_actor_film` FOREIGN KEY (`film_id`) REFERENCES `sakila`.`film` (`film_id`) ON DELETE RESTRICT ON UPDATE CASCADE
</pre></blockquote>

<p>Save all of sakila's foreign keys ADD CONSTRAINT statements to file:</p>
<blockquote><pre><strong>mysql&gt;</strong> SELECT create_statement FROM common_schema.sql_foreign_keys WHERE TABLE_SCHEMA='sakila' INTO OUTFILE '/tmp/create_sakila_foreign_keys.sql'

<strong>bash$</strong> cat /tmp/create_sakila_foreign_keys.sql 
ALTER TABLE `sakila`.`address` ADD CONSTRAINT `fk_address_city` FOREIGN KEY (`city_id`) REFERENCES `sakila`.`city` (`city_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`city` ADD CONSTRAINT `fk_city_country` FOREIGN KEY (`country_id`) REFERENCES `sakila`.`country` (`country_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`customer` ADD CONSTRAINT `fk_customer_address` FOREIGN KEY (`address_id`) REFERENCES `sakila`.`address` (`address_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`customer` ADD CONSTRAINT `fk_customer_store` FOREIGN KEY (`store_id`) REFERENCES `sakila`.`store` (`store_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`film` ADD CONSTRAINT `fk_film_language` FOREIGN KEY (`language_id`) REFERENCES `sakila`.`language` (`language_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`film` ADD CONSTRAINT `fk_film_language_original` FOREIGN KEY (`original_language_id`) REFERENCES `sakila`.`language` (`language_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`film_actor` ADD CONSTRAINT `fk_film_actor_actor` FOREIGN KEY (`actor_id`) REFERENCES `sakila`.`actor` (`actor_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`film_actor` ADD CONSTRAINT `fk_film_actor_film` FOREIGN KEY (`film_id`) REFERENCES `sakila`.`film` (`film_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`film_category` ADD CONSTRAINT `fk_film_category_category` FOREIGN KEY (`category_id`) REFERENCES `sakila`.`category` (`category_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`film_category` ADD CONSTRAINT `fk_film_category_film` FOREIGN KEY (`film_id`) REFERENCES `sakila`.`film` (`film_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`inventory` ADD CONSTRAINT `fk_inventory_film` FOREIGN KEY (`film_id`) REFERENCES `sakila`.`film` (`film_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`inventory` ADD CONSTRAINT `fk_inventory_store` FOREIGN KEY (`store_id`) REFERENCES `sakila`.`store` (`store_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`payment` ADD CONSTRAINT `fk_payment_customer` FOREIGN KEY (`customer_id`) REFERENCES `sakila`.`customer` (`customer_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`payment` ADD CONSTRAINT `fk_payment_rental` FOREIGN KEY (`rental_id`) REFERENCES `sakila`.`rental` (`rental_id`) ON DELETE SET NULL ON UPDATE CASCADE
ALTER TABLE `sakila`.`payment` ADD CONSTRAINT `fk_payment_staff` FOREIGN KEY (`staff_id`) REFERENCES `sakila`.`staff` (`staff_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`rental` ADD CONSTRAINT `fk_rental_customer` FOREIGN KEY (`customer_id`) REFERENCES `sakila`.`customer` (`customer_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`rental` ADD CONSTRAINT `fk_rental_inventory` FOREIGN KEY (`inventory_id`) REFERENCES `sakila`.`inventory` (`inventory_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`rental` ADD CONSTRAINT `fk_rental_staff` FOREIGN KEY (`staff_id`) REFERENCES `sakila`.`staff` (`staff_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`staff` ADD CONSTRAINT `fk_staff_address` FOREIGN KEY (`address_id`) REFERENCES `sakila`.`address` (`address_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`staff` ADD CONSTRAINT `fk_staff_store` FOREIGN KEY (`store_id`) REFERENCES `sakila`.`store` (`store_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`store` ADD CONSTRAINT `fk_store_address` FOREIGN KEY (`address_id`) REFERENCES `sakila`.`address` (`address_id`) ON DELETE RESTRICT ON UPDATE CASCADE
ALTER TABLE `sakila`.`store` ADD CONSTRAINT `fk_store_staff` FOREIGN KEY (`manager_staff_id`) REFERENCES `sakila`.`staff` (`staff_id`) ON DELETE RESTRICT ON UPDATE CASCADE
</pre></blockquote>
<p>Note again that the SQL statements are not terminated by ';'. 
Either CONCAT() these beforehand, or use <i>sed</i>/<i>awk</i> afterwards.</p>

<h3>ENVIRONMENT</h3>
MySQL 5.1 or newer

<h3>SEE ALSO</h3>
<a href="sql_alter_table.html">sql_alter_table</a>
<h3>AUTHOR</h3>
Shlomi Noach
				<br/>
			</div>
			<div id="sidebarwrapper">
				<div id="menu">
					<ul>
						<li><a title="Introduction" href="introduction.html">Introduction</a></li>
						<li><a title="Download" href="download.html">Download</a></li>
						<li><a title="Install" href="install.html">Install</a></li>
						<li><a title="Risks" href="risks.html">Risks</a></li>
					</ul>						
					<h3>VIEWS</h3>
					<ul>
						<li><a title="auto_increment_columns" href="auto_increment_columns.html">auto_increment_columns</a></li>

						<li><a title="candidate_keys" href="candidate_keys.html">candidate_keys</a></li>

						<li><a title="data_size_per_engine" href="data_size_per_engine.html">data_size_per_engine</a></li>
						<li><a title="data_size_per_schema" href="data_size_per_schema.html">data_size_per_schema</a></li>


						<li><a title="global_status_diff" href="global_status_diff.html">global_status_diff</a></li>
						<li><a title="global_status_diff_clean" href="global_status_diff_clean.html">global_status_diff_clean</a></li>
						<li><a title="global_status_diff_nonzero" href="global_status_diff_nonzero.html">global_status_diff_nonzero</a></li>

						<li><a title="innodb_locked_transactions" href="innodb_locked_transactions.html">innodb_locked_transactions</a></li>

						<li><a title="innodb_index_rows" href="innodb_index_rows.html">innodb_index_rows</a></li>
						<li><a title="innodb_index_stats" href="innodb_index_stats.html">innodb_index_stats</a></li>

						<li><a title="innodb_simple_locks" href="innodb_simple_locks.html">innodb_simple_locks</a></li>
						<li><a title="innodb_transactions" href="innodb_transactions.html">innodb_transactions</a></li>
						<li><a title="innodb_transactions_summary" href="innodb_transactions_summary.html">innodb_transactions_summary</a></li>

						<li><a title="no_pk_innodb_tables" href="no_pk_innodb_tables.html">no_pk_innodb_tables</a></li>
						
						<li><a title="processlist_grantees" href="processlist_grantees.html">processlist_grantees</a></li>
						<li><a title="processlist_per_userhost" href="processlist_per_userhost.html">processlist_per_userhost</a></li>
						<li><a title="processlist_repl" href="processlist_repl.html">processlist_repl</a></li>
						<li><a title="processlist_summary" href="processlist_summary.html">processlist_summary</a></li>
						<li><a title="processlist_top" href="processlist_top.html">processlist_top</a></li>
						
						<li><a title="redundant_keys" href="redundant_keys.html">redundant_keys</a></li>
						<li><a title="routine_privileges" href="routine_privileges.html">routine_privileges</a></li>
						
						<li><a title="sql_alter_table" href="sql_alter_table.html">sql_alter_table</a></li>
						<li><a title="sql_foreign_keys" href="sql_foreign_keys.html">sql_foreign_keys</a></li>
						<li><a title="sql_grants" href="sql_grants.html">sql_grants</a></li>
						<li><a title="sql_show_grants" href="sql_show_grants.html">sql_show_grants</a></li>

						<li><a title="table_charset" href="table_charset.html">table_charset</a></li>
						<li><a title="text_columns" href="text_columns.html">text_columns</a></li>						
					</ul>						
					<h3>TABLES</h3>
					<ul>
						<li><a title="numbers" href="numbers.html">numbers</a></li>
					</ul>						
					<h3>FUNCTIONS</h3>
					<ul>
						<li><a title="General functions" href="general_functions.html">General functions</a></li>
						<li><a title="Privileges functions" href="privileges_functions.html">Privileges functions</a></li>
						<li><a title="String functions" href="string_functions.html">String functions</a></li>
						<li><a title="Time & date functions" href="time_functions.html">Time & date functions</a></li>
					</ul>
					<h3>PROCEDURES</h3>
					<ul>
						<li><a title="General procedures" href="general_procedures.html">General procedures</a></li>
					</ul>
				</div>
			</div>	
			<div class="clear">&nbsp;</div>
			
			<div id="footnote" align="center">
				<a href="">common_schema</a> documentation
			</div>
		</div>
	</div>
</body>
</html>
